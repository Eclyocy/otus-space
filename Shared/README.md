# Библиотека с общими ресурсами и утилитами

## Enums

Набор перечислений типов ресурсов и их состояний.

### EventLevel

Уровни критичности проблем от генератора событий:
- Low
- Medium
- High

[EventLevel.cs](./Enums/EventLevel.cs)

### ResourceState

Возможные состояния ресурсов и компонентов корабля:
- Ok - нормальное состояние, ресурс в работе или может быть использован в любой момент, на поддержание этого сосотояния потребляются зависимые ресурсы каждый игровой день
- Sleep - ресурс исправен, но не активен, ресурсы на поддержание этого состояния не расходуются
- Fail - ресурс повреждён, использовать его нельзя, на поддержание состояния другие ресурсы не используются, но могут быть запрошены на восстановление состояния до рабочего (Ok).

[ResourceState.cs](./Enums/ResourceState.cs)

### ResourceType

Типы ресурсов на корабле.

[ResourceType](./Enums/ResourceType.cs)

### ShipState

Набор возможных состояний корабля:
- OK - нормальное рабочее состояние, полёт возможен или проходит в штатном режиме
- Adrift - корабль лег в дрейф, в штатном реиме полет невозможен, например из-за нехватки топлива или неисправности двигателя. Возможен переход в нормальное состояние.
- Crashed - корабль разбился, нет возможности завершить миссию, например повреждён корпус и ресурсов для ремонта недостаточно. Миссия провалена.
- Arrived - корабль прибыл в пункт назначения. За отведённое игровое время (число дней - шагов игры) хватило ресурсов на полет (поддержание нормального сосотояния) и устранение неисправностей от генератора проблем. Миссия успешно выполнена.

[ShipState](./Enums/ShipState.cs)

## Key-based lock

Реализован как IDisposable, полагается на ConcurrentDictionary:
- ключ — это идентификатор объекта
- значение — SemaphoreSlim(1, 1)

Пример использования в [UserService](../GameController/GameController.Services/Services/UserService.cs)

```
    // объявление в качестве static поля
    private static readonly KeyBasedLock<Guid> _semaphoreLock = new();

    ...

    using (await _semaphoreLock.LockAsync(userId, _logger, CancellationToken.None))
    {
        ...
        User user = UpdateRepositoryUser(userId, updateUserDto);
        ...
    }
```

[KeyBasedLock.cs](./Utilities/KeyBasedLock.cs)
